<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Multitool</title>

  <style>
    /* Background image on the body */
    body {
      margin: 0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background-image: url('download.jpg'); /* keep your background filename */
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      min-height: 100vh;
      color: #111;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 24px;
    }

    /* Panel so text is readable on the background */
    .panel {
      background: rgba(255,255,255,0.9);
      max-width: 900px;
      width: 100%;
      border-radius: 10px;
      padding: 20px 24px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.12);
    }

    img.profile {
      display: block;
      max-width: 100%;
      height: auto;
      margin: 12px auto;
      border-radius: 6px;
    }

    h1 { margin-top: 0; font-size: 1.8rem; }
    h2 { font-size: 1.05rem; font-weight: 500; color: #333; }
    a { color: #0066cc; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .meta { margin-top: 8px; color: #666; font-size: 0.9rem; }

    /* Login modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 40;
    }
    .modal {
      background: white;
      border-radius: 8px;
      padding: 18px;
      width: 320px;
      box-shadow: 0 8px 30px rgba(0,0,0,0.25);
    }
    .modal h3 { margin-top: 0; }
    .form-row { margin-bottom: 10px; display:flex; flex-direction:column; }
    .form-row label { font-size: 0.85rem; margin-bottom: 4px; color:#333; }
    .form-row input, .form-row textarea {
      padding: 8px;
      border-radius: 6px;
      border: 1px solid #ddd;
      font-size: 0.95rem;
    }
    .btn {
      display: inline-block;
      padding: 8px 12px;
      border-radius: 6px;
      border: none;
      background: #0066cc;
      color: white;
      cursor: pointer;
      font-size: 0.95rem;
    }
    .btn.secondary { background: #888; }
    .controls { margin-top: 10px; display:flex; gap:8px; flex-wrap:wrap; }

    /* Comments area */
    .comments {
      margin-top: 18px;
    }
    .comment {
      border-top: 1px solid #eee;
      padding: 10px 0;
    }
    .comment .meta { font-size: 0.85rem; color: #555; }
    .comment .body { margin-top: 6px; white-space: pre-wrap; }

    /* small screens */
    @media (max-width: 520px) {
      .modal { width: 92%; }
      body { padding: 12px; }
    }

    /* Visible state utility */
    .is-visible { display: flex !important; }
  </style>
</head>
<body>
  <main class="panel" role="main">
    <!-- Keeping your original purposeful typos and text -->
    <h1>		Hungry Hungry man website		</h1>
    <h2>This is a verry hungry man, the hungry hungry man and he is in fact the hungriest man of them all </h2>
    <h3>--------------------</h3>
    <h4>Picture of him below</h4>

    <!-- keep the original filename from your example -->
    <img class="profile" src="HungryHungyMan612x612.jpg" alt="Trulli" width="612" height="612">

    <div class="meta"><strong>Links:</strong></div>
    <p><a href="SubDomain.html">Sub Domain</a></p>
    <p><a href="https://www.google.com/" target="_blank" rel="noopener noreferrer">Goolge</a></p>

    <hr>

    <!-- Login / user area -->
    <div id="user-area">
      <div id="welcome" style="display:none;">
        Signed in as <span id="current-user" style="font-weight:600"></span>
        <div class="controls" style="margin-top:8px;">
          <button id="logoutBtn" class="btn secondary">Logout</button>
        </div>
      </div>
      <div id="signed-out" style="display:none;">
        <button id="openLogin" class="btn">Login</button>
      </div>
    </div>

    <!-- Comment form -->
    <section class="comments" aria-labelledby="comments-heading">
      <h4 id="comments-heading">Comments</h4>

      <div id="must-login" style="color:#aa0000; display:none; margin-bottom:8px;">
        You must be logged in to post a comment. <button id="quickLogin" class="btn">Login now</button>
      </div>

      <form id="commentForm" style="margin-bottom:12px;">
        <div class="form-row">
          <label for="commentText">Write a comment</label>
          <textarea id="commentText" rows="4" placeholder="Type your thoughts..." required></textarea>
        </div>
        <div class="controls">
          <button type="submit" class="btn">Post comment</button>
          <button type="button" id="clearAll" class="btn secondary">Clear all comments</button>
        </div>
      </form>

      <div id="commentsList" aria-live="polite"></div>
    </section>
  </main>

  <!-- Login modal -->
  <div id="loginModal" class="modal-backdrop" role="dialog" aria-modal="true" aria-hidden="true">
    <div class="modal" role="document">
      <h3>Login</h3>
      <form id="loginForm">
        <div class="form-row">
          <label for="username">Username</label>
          <input id="username" required placeholder="e.g. hungriest123" />
        </div>
        <div class="form-row">
          <label for="password">Password</label>
          <input id="password" type="password" placeholder="password (any will work)" />
        </div>
        <div class="controls">
          <button type="submit" class="btn">Sign in</button>
          <button type="button" id="closeLogin" class="btn secondary">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <script>
    // Utility to escape HTML and avoid XSS
    function escapeHtml(str) {
      if (!str) return '';
      return str.replace(/[&<>"'`=\/]/g, function(s) {
        return ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;',
          '/': '&#x2F;',
          '`': '&#x60;',
          '=': '&#x3D;'
        })[s];
      });
    }

    // Storage keys
    const USER_KEY = 'hhm_user_v1';
    const COMMENTS_KEY = 'hhm_comments_v1';

    // Elements
    const loginModal = document.getElementById('loginModal');
    const openLogin = document.getElementById('openLogin');
    const closeLogin = document.getElementById('closeLogin');
    const loginForm = document.getElementById('loginForm');
    const usernameInput = document.getElementById('username');
    const passwordInput = document.getElementById('password');
    const welcome = document.getElementById('welcome');
    const signedOut = document.getElementById('signed-out');
    const currentUserEl = document.getElementById('current-user');
    const logoutBtn = document.getElementById('logoutBtn');
    const commentForm = document.getElementById('commentForm');
    const commentText = document.getElementById('commentText');
    const commentsList = document.getElementById('commentsList');
    const mustLogin = document.getElementById('must-login');
    const quickLogin = document.getElementById('quickLogin');
    const clearAllBtn = document.getElementById('clearAll');

    // Helpers for localStorage
    function saveUser(user) {
      localStorage.setItem(USER_KEY, JSON.stringify(user));
    }
    function loadUser() {
      const raw = localStorage.getItem(USER_KEY);
      return raw ? JSON.parse(raw) : null;
    }
    function clearUser() {
      localStorage.removeItem(USER_KEY);
    }
    function loadComments() {
      const raw = localStorage.getItem(COMMENTS_KEY);
      return raw ? JSON.parse(raw) : [];
    }
    function saveComments(arr) {
      localStorage.setItem(COMMENTS_KEY, JSON.stringify(arr));
    }

    // UI state update
    function updateUserUI() {
      const user = loadUser();
      if (user && user.name) {
        welcome.style.display = 'block';
        signedOut.style.display = 'none';
        currentUserEl.textContent = user.name;
        mustLogin.style.display = 'none';
      } else {
        welcome.style.display = 'none';
        signedOut.style.display = 'block';
        mustLogin.style.display = 'block';
      }
    }

    // Render comments
    function renderComments() {
      const comments = loadComments();
      if (!comments.length) {
        commentsList.innerHTML = '<p style="color:#666">No comments yet — be the first to post.</p>';
        return;
      }
      commentsList.innerHTML = comments.map(c => {
        // Format time in Europe/Stockholm where possible
        let timeStr = c.time;
        try {
          const dt = new Date(c.time);
          timeStr = dt.toLocaleString(undefined, { timeZone: 'Europe/Stockholm' });
        } catch (e) {}
        return `
          <article class="comment" data-id="${escapeHtml(c.id)}">
            <div class="meta"><strong>${escapeHtml(c.user)}</strong> — <span>${escapeHtml(timeStr)}</span></div>
            <div class="body">${escapeHtml(c.text)}</div>
          </article>
        `;
      }).join('');
    }

    // Open / close modal helpers
    function showLoginModal() {
      loginModal.classList.add('is-visible');
      loginModal.setAttribute('aria-hidden', 'false');
      usernameInput.focus();
    }
    function hideLoginModal() {
      loginModal.classList.remove('is-visible');
      loginModal.setAttribute('aria-hidden', 'true');
      loginForm.reset();
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', () => {
      updateUserUI();
      renderComments();
    });

    openLogin?.addEventListener('click', showLoginModal);
    quickLogin?.addEventListener('click', showLoginModal);
    closeLogin?.addEventListener('click', hideLoginModal);

    loginForm?.addEventListener('submit', (e) => {
      e.preventDefault();
      const name = usernameInput.value.trim();
      // We're intentionally simple: accept any non-empty username.
      if (!name) { alert('Please enter a username'); return; }
      saveUser({ name });
      updateUserUI();
      hideLoginModal();
    });

    logoutBtn?.addEventListener('click', () => {
      if (!confirm('Logout?')) return;
      clearUser();
      updateUserUI();
    });

    commentForm?.addEventListener('submit', (e) => {
      e.preventDefault();
      const user = loadUser();
      if (!user || !user.name) {
        showLoginModal();
        return;
      }
      const text = commentText.value.trim();
      if (!text) { alert('Comment may not be empty'); return; }
      const comments = loadComments();
      const newComment = {
        id: 'c_' + Date.now(),
        user: user.name,
        text: text,
        time: new Date().toISOString()
      };
      comments.unshift(newComment); // newest first
      saveComments(comments);
      commentText.value = '';
      renderComments();
    });

    clearAllBtn?.addEventListener('click', () => {
      if (!confirm('Clear all comments? This cannot be undone.')) return;
      saveComments([]);
      renderComments();
    });

    // Close modal when clicking backdrop
    loginModal?.addEventListener('click', (ev) => {
      if (ev.target === loginModal) hideLoginModal();
    });

    // Allow pressing Escape to close modal
    window.addEventListener('keydown', (ev) => {
      if (ev.key === 'Escape') hideLoginModal();
    });
  </script>
</body>
</html>
